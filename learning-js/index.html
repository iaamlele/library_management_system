<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Reproduce jQuery using C language</title>

    <!-- jquery测试 -->
    <!-- <script src="https://code.jquery.com/jquery-3.7.1.js"
    integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
    <script>
            $(document).ready(function(){
                $("button").click(function(){
                    // $("p").hide(1000, "swing", function() {
                    //     $("#first-h2").hide(1000, "linear");
                    // }); //第二个参数：jQuery自身提供"linear" 和 "swing"
                    $("p").fadeOut();
                });
            });
    </script> -->
</head>

<body>

    <div id="first">
        <h1>h1:测试hide和show</h1>
        <button id="button1">hide</button>
        <button id="button2">show</button>
        <button id="button3">hide/show</button>
        <p id="first-id" class="class test">这是第一个段落。</p>
    </div>

    <div id="second">
        <div class="second-class1">
            <h2 id="first-h2">这是第一个h2标题</h2>
            <p id="second-p" class="class test">这是第二个段落。</p>
        </div>
    </div>

    <script>
        // 训练编码能力，原型可优化，先自己优化。打算看看github上别人的写法，先自己写，再借鉴学习。

        class Class_${
            constructor(arg) {
                this.arg = arg;

                const elements = [];
                this.elements = elements;

                if(typeof arg === "string") {
                    const arg_class = new RegExp("^\\..*");
                    const arg_id = new RegExp("^#.*");
                    const arg_tag = new RegExp("^[a-zA-Z][a-zA-z0-9]*");
                    if(arg_class.test(arg)) {
                        const classes = document.getElementsByClassName(arg.slice(1));
                        elements.push(classes);
                    }else if(arg_id.test(arg)) {
                        const ids = document.getElementById(arg.slice(1));
                        elements.push(ids);
                        elements[1] = 1;
                    }else if(arg_tag.test(arg)) {
                        const tags = document.getElementsByTagName(arg);
                        elements.push(tags);
                    }
                }else if(typeof arg === "object") {
                    elements.push(arg);
                }

                if(!Class_$.instance) {
                    Class_$.instance = this;
                }

                return Class_$.instance;             
            }

            entrance(arg) {
                this.elements = [];
                if(typeof arg === "string") {
                    const arg_class = new RegExp("^\\..*");
                    const arg_id = new RegExp("^#.*");
                    const arg_tag = new RegExp("^[a-zA-Z][a-zA-z0-9]*");
                    this.elements[1] = 0;
                    if(arg_class.test(arg)) {
                        const classes = document.getElementsByClassName(arg.slice(1));
                        this.elements.push(classes);
                    }else if(arg_id.test(arg)) {
                        const ids = document.getElementById(arg.slice(1));
                        this.elements[0] = ids;
                        this.elements[1] = 1;
                        
                    }else if(arg_tag.test(arg)) {
                        const tags = document.getElementsByTagName(arg);
                        this.elements.push(tags);
                    }
                }else if(typeof arg === "object") {
                    this.elements.push(arg);
                }

                if(!Class_$.instance) {
                    Class_$.instance = this;
                }

                return this;
            }

            hide() {
                const elem = this.elements[0];
                const is_id = this.elements[1];
                if(is_id === 1) {
                    elem.style.visibility = 'hidden';
                }else {
                    for(let i = 0; i < elem.length; i++) {
                        elem.item(i).style.visibility = 'hidden';
                    }
                }
                return this;
            }

            show() {
                const elem = this.elements[0];
                const is_id = this.elements[1];
                if(is_id === 1) {
                    elem.style.visibility = 'visible';
                }else {
                    for(let i = 0; i < elem.length; i++) {
                        elem.item(i).style.visibility = 'visible';
                    }
                }
                return this;
            }

            ready(f) {
                const elem = this.elements[0];
                if(elem === document) {
                    return document.addEventListener("DOMContentLoaded", f, false);
                }else {
                    return null;
                }
                
            }
        }

        const $ = (function() {
            let instance;
            function init(arg) {
                if(!instance) {
                    instance = new Class_$(arg);
                }else {
                    instance.entrance(arg);
                }
                return instance;
            }
            return function(arg) {
                return init(arg);
            }
        })();

        $(document).ready(function() {
            $("#first-id").hide().show();
        });
    </script>

    <!-- <script type="module" src="test.js"></script> -->
    

</body>

</html>